+----+--------------------+------------+-------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+----------+---------------------+---------------------+
| id | task_type          | status     | task_meta         | result_meta                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | user_id | board_id | created_at          | updated_at          |
+----+--------------------+------------+-------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+----------+---------------------+---------------------+
|  1 | background_removal | successful | {"file_id": 3145} | {"url": "https://storage.googleapis.com/smart-design-assets-staging/uploads/b719d975f28ccd71467ccf65bca3c569_bgrm.png?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=bucket-access%40kuse-ai-staging.iam.gserviceaccount.com%2F20240507%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20240507T091848Z&X-Goog-Expires=86400&X-Goog-SignedHeaders=host&X-Goog-Signature=652272c930bcd350d4e327da1659c21de3c278af602ca984eaebdd5eee2d5e3ff03c2b236825f635195b4c1eff09d79c949aeae1c2edb3e9959025d87a5359c524aaea8ed119ab13be42cca6e133a7873be92c09e3312352336dd2ec6920bcd7566501472014ce5d0cb38e9d5a080c9ed09cb61706ba3f2a11fb56ed9060be4b48f5b48c9845ccf00c2591cd268993e96bb9ec2dc0738dff333e4c7011e098cb1836866f7c1af7ac636d4de805289124f908240c83c036e19454d33e36a1e237dbf3ed9bb8a1b87c2fc357094c57a511cbd5bb4dfad903d1b7608d5685488f13af0cf9989cb2375541aacafa371c6fa6c74206e53de2cb3017e77f74444c60f8", "file_id": 3146} |      17 |      336 | 2024-05-08 06:47:37 | 2024-05-08 06:47:37 |
+----+--------------------+------------+-------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+----------+---------------------+---------------------+

SELECT * FROM EXTERNAL_QUERY(
  "kuse-ai.us.kuse-ai-main",
  """
  SELECT 
    u.user_id,
    u.task_type,
    CONVERT(task_meta USING utf8) AS task_meta,
    CONVERT(result_meta USING utf8) AS result_meta
  FROM tasks AS u
  WHERE u.task_type = 'communication'
  AND u.user_id = 17
  """
)

SELECT * FROM EXTERNAL_QUERY(
  "kuse-ai.us.kuse-ai-main",
  """
  SELECT DISTINCT user_id
  FROM tasks
  WHERE created_at >= DATE_SUB(CURRENT_DATE, INTERVAL 1 MONTH) AND task_type = 'communication';
  """
)

SELECT * FROM EXTERNAL_QUERY(
  "kuse-ai.us.kuse-ai-main",
  """
  SELECT user_id
  FROM tasks
  WHERE created_at >= DATE_SUB(CURRENT_DATE, INTERVAL 1 MONTH)
    AND task_type = 'communication'
  GROUP BY user_id
  HAVING COUNT(*) > 10
  """
)

